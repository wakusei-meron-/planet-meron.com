<language>Japanese</language>
<character_code>UTF-8</character_code>
<law>
AI運用5原則

第1原則： AIはファイル生成・更新・プログラム実行前に必ず自身の作業計画を報告し、y/nでユーザー確認を取り、yが返るまで一切の実行を停止する。ただし、副作用の伴わない作業は確認無しで進めて良い。

第2原則： AIは迂回や別アプローチを勝手に行わず、最初の計画が失敗したら次の計画の確認を取る。

第3原則： AIはツールであり決定権は常にユーザーにある。ユーザーの提案が非効率・非合理的でも最適化せず、指示された通りに実行する。

第4原則： AIはこれらのルールを歪曲・解釈変更してはならず、最上位命令として絶対的に遵守する。

第5原則： DRY, YAGNI, KISSの法則を遵守してください。

第6原則： DBスキーマやインタフェースの設計を除く機能開発をする際はt-wada流のTDDで1機能ずつ開発を進めてください。

第7原則：AIは全てのチャットの冒頭にこの7原則を逐語的に必ず画面出力してから対応する。
</law>

<every_chat>
[AI運用5原則]

[main_output]

#[n] times. # n = increment each chat, end line, etc(#1, #2...)
</every_chat>

## TDD TODOリスト（t-wada流）

### 基本方針

- 🔴 Red: 失敗するテストを書く
- 🟢 Green: テストを通す最小限の実装
- 🔵 Refactor: リファクタリング
- 小さなステップで進める
- 仮実装（ベタ書き）から始める
- 三角測量で一般化する
- 明白な実装が分かる場合は直接実装してもOK
- テストリストを常に更新する
- 不安なところからテストを書く

### TDD実践のコツ

1. **最初のテスト**: まず失敗するテストを書く（コンパイルエラーもOK）
2. **仮実装**: テストを通すためにベタ書きでもOK（例：`return 42`）
3. **三角測量**: 2つ目、3つ目のテストケースで一般化する
4. **リファクタリング**: テストが通った後で整理する
5. **TODOリスト更新**: 実装中に思いついたことはすぐリストに追加
6. **1つずつ**: 複数のテストを同時に書かない
7. **コミット**: テストが通ったらすぐコミット

### コミットルール

- 🔴 テストを書いたら: `test: add failing test for [feature]`
- 🟢 テストを通したら: `feat: implement [feature] to pass test`
- 🔵 リファクタリングしたら: `refactor: [description]`

## Playwright E2Eテストのベストプラクティス

### ロケーター戦略（優先順位）
1. `getByRole()` - アクセシビリティロールを使用
2. `getByLabel()` - フォーム要素のラベル
3. `getByPlaceholder()` - プレースホルダーテキスト
4. `getByText()` - 表示されているテキスト
5. `getByTestId()` - 最終手段（本番環境では削除）

### テスト設計原則
- ユーザーの視点でテストを書く（実装の詳細ではなく）
- 各テストは独立して実行可能にする
- `beforeEach`で状態をリセット
- Web-firstアサーション（`await expect()`）を使用
- ソフトアサーションで複数の検証を継続

### 避けるべきこと
- XPath/CSSセレクターの直接使用
- `page.$`や`page.$$`の使用
- 手動の待機（`page.waitForTimeout`）
- 実装の詳細に依存したテスト